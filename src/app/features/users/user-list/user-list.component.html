<div class="container max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold tracking-tight">Users</h1>
      <p class="text-muted-foreground mt-2">
        Manage user accounts and permissions
      </p>
    </div>
    <app-button [href]="['/users', 'new']">
      <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      Add User
    </app-button>
  </div>

  @if (usersService.isLoading()) {
    <app-loading-spinner message="Loading users..." containerClass="py-12" />
  } @else if (usersService.users().length === 0) {
    <app-card>
      <app-card-content class="flex flex-col items-center justify-center py-16">
        <svg class="h-16 w-16 text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <h3 class="text-lg font-semibold mb-2">No users found</h3>
        <p class="text-sm text-muted-foreground mb-4">
          Get started by adding your first user.
        </p>
        <app-button [href]="['/users', 'new']" variant="outline">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          Add Your First User
        </app-button>
      </app-card-content>
    </app-card>
  } @else {
    <app-card>
      <app-card-header>
        <app-card-title>All Users ({{ usersService.usersCount() }})</app-card-title>
      </app-card-header>
      <app-card-content class="p-0">
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="border-b bg-muted/50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                  User
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                  Role
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">
                  Status
                </th>
                <th class="px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody class="divide-y">
              @for (user of usersService.users(); track user.id) {
                <tr class="hover:bg-muted/50 transition-colors">
                  <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                      <div class="h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center">
                        <span class="text-sm font-semibold text-primary">
                          {{ user.name.charAt(0).toUpperCase() }}
                        </span>
                      </div>
                      <div>
                        <div class="font-medium">{{ user.name }}</div>
                        <div class="text-sm text-muted-foreground">{{ user.email }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <app-badge [variant]="user.role === 'ADMIN' ? 'default' : 'secondary'">
                      {{ user.role }}
                    </app-badge>
                  </td>
                  <td class="px-6 py-4">
                    <app-badge [variant]="user.enabled ? 'success' : 'destructive'">
                      {{ user.enabled ? 'Active' : 'Disabled' }}
                    </app-badge>
                  </td>
                  <td class="px-6 py-4">
                    <div class="flex justify-end gap-2">
                      <app-button [href]="['/users', user.id, 'edit']" variant="ghost" size="sm">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                      </app-button>
                      <app-button variant="ghost" size="sm" (click)="openDeleteDialog(user)">
                        <svg class="h-4 w-4 text-destructive" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                      </app-button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </app-card-content>
    </app-card>
  }
</div>

<app-confirmation-dialog
  [isOpen]="deleteDialogOpen()"
  title="Delete User"
  [message]="'Are you sure you want to delete \'' + (userToDelete()?.name || '') + '\'? This action cannot be undone.'"
  confirmText="Delete"
  (confirmed)="confirmDelete()"
  (cancelled)="cancelDelete()"
/>
